
{% extends "base.html" %}
{% load static %}

{% block title %}Weekly Menu{% endblock %}

{% block content %}
{% if user.is_authenticated %}
    {% if user.username == 'fahm' %} 
        <h2 class="display-4 text-center fadeInUp"><strong><span class="MainHeadline">Explore Our Menus</span></strong></h2>
        <p class="text-center mb-5 custom-font text-light"><strong>Select your favorite items and place an order in just a few clicks!</strong></p> 
    {% endif %}
{% endif %}

<!-- ********************* Slide Show ****************************************************************************-->
<div class="container-fluid">
    <div class="row">
        <div class="col-lg-12">
            <div class="container">
                <div id="carouselExampleCaptions" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <img src="{% static 'images/karara_eats_banner_1.png' %}" class="d-block w-100 blurred-bg" alt="...">
                        </div>
                        <div class="carousel-item">
                            <img src="{% static 'images/karara_eats_banner_1.png' %}" class="d-block w-100 blurred-bg" alt="...">
                        </div>
                        <div class="carousel-item">
                            <img src="{% static 'images/karara_eats_banner_1.png' %}" class="d-block w-100 blurred-bg" alt="...">
                        </div>
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="false"></span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="false"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid">
    <div class="row">
        <!-- Sidebar with days of the week -->
        <div class="col-md-3 sidebar mt-5">
            <h3 class="sidebar-title text-center mt-5 mb-4">Menu of This Week</h3>
            <div class="tabs">
                {% for menu in menus %}
                    <button class="tab-button" onclick="showMenu('{{ menu.name }}')">
                        <span class="display-4 text-center fadeInUp mt-3">{{ menu.name }}</span>
                    </button>
                {% endfor %}
            </div>
        </div>

        <!-- Main content area for menu items -->
        <div class="col-md-9 menu-content">
            {% csrf_token %}
            <div id="menuContent" class="mt-5">
                {% for menu in menus %}
                    <h3 class="sidebar-title text-center mt-5 mb-4">{{ menu.name }}</h3>
                    <div id="{{ menu.name }}" class="menu-section" style="display: none;">
                        <input type="hidden" name="menu_id" value="{{ menu.id }}" >
                        <div class="menu-items">
<!-- Notification container (hidden by default) -->
<div id="notification-container" style="position: fixed; top: 10px; right: 10px; display: none; background-color: #4CAF50; color: white; padding: 10px; border-radius: 5px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
    Item added to cart!
</div>
                            {% for item in menu.food_items.all %}
                            <div class="menu-item mb-3">
                                <!-- Single Add to Cart button -->
                                <button id="add-button_{{ item.id }}_{{ menu.id }}" class="item-button w-100 d-flex align-items-center p-3">
                                    <div class="item-info flex-grow-1">
                                        <strong class="item-name" style="font-size: 1.2em; color: darkslateblue;">{{ item.name }}</strong>
                                        <h5 class="item-price text-left" style="color: darkblue;">AU$ {{ item.price }}</h5>
                                        
                                        <!-- Initially hidden quantity input -->
                                        <input type="number" id="quantities_{{ item.id }}_{{ menu.id }}" name="quantities_{{ item.id }}_{{ menu.id }}" min="1" max="10" class="form-control item-quantity" value="0" style="width: 70px; margin-right: 10px; display: none;">
                                        <span id="quantity-label_{{ item.id }}_{{ menu.id }}" style="display: none;">Please Enter Quantity</span> 
                        
                                        <!-- Default button text -->
                                        <span id="add-text_{{ item.id }}_{{ menu.id }}">Add to Cart</span>
                                    </div>
                                    {% if item.picture %}
                                        <div class="item-image">
                                            <img src="{{ item.picture.url }}" alt="{{ item.name }}" class="img-fluid" style="height: 70px; width: 70px; object-fit: cover; border-radius: 50%;">
                                        </div>
                                    {% endif %}
                                </button>
                            </div>
                        {% endfor %}
                        

                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<script>
// Ensure the correct menu is displayed when clicked
document.querySelectorAll('.tab-button').forEach(button => {
    button.addEventListener('click', () => {
        const menuName = button.textContent.trim();
        document.querySelectorAll('.menu-section').forEach(section => {
            section.style.display = section.id === menuName ? 'block' : 'none';
        });
    });
});
    // Show the first menu by default
    window.onload = function() {
    document.querySelector('.tab-button').click();
    };

// Handle the 'Add to Cart' button clicks
document.querySelectorAll('.item-button').forEach(button => {
    button.addEventListener('click', function(e) {
       

        // Get the item and menu ID from the button's ID
        const buttonId = button.id.split('_'); // Split the ID by the underscore
        const itemId = buttonId[1]; // The item ID is at index 1
        const menuId = buttonId[2]; // The menu ID is at index 2 (in case it's needed)
        console.log(`Button clicked with ID ${itemId} ${menuId}`);

        const quantity = document.getElementById(`quantities_${itemId}_${menuId}`).value;


         // Get the corresponding elements for this item
         const quantityInput = document.getElementById(`quantities_${itemId}_${menuId}`);
        const quantityLabel = document.getElementById(`quantity-label_${itemId}_${menuId}`);
        const addText = document.getElementById(`add-text_${itemId}_${menuId}`);


        console.log(`quantityInput is :: ${quantityInput} quantityLabel is :: ${quantityLabel}`);
        console.log(`addText is :: ${addText}`);
        console.log(`quantity is :: ${quantity}`);


        if (quantityInput.style.display === 'none' || quantityInput.style.display === '') {
            // Show the quantity input field
            quantityInput.style.display = 'inline-block';
            quantityLabel.style.display = 'inline-block';  // Show "Enter Quantity" label

            // Change the button text to something like "Confirm Quantity"
            //addText.textContent = 'Confirm Quantity';
        } 

        // Check if the quantity is greater than 0
        if (quantity > 0) {
                // Send the item data to the cart using AJAX
                jQuery.ajax({
                    type: 'POST',
                    url: '{% url "cart-add" %}',  // Use Django's URL tag to send the request to the correct endpoint
                    data: {
                        menu_id: menuId,  // Send the menu ID
                        item_id: itemId,  // Send the item ID
                        qty: quantity,          // Send the quantity
                        csrfmiddlewaretoken: "{{ csrf_token }}",  // Send CSRF token for security
                        action: 'post'     // Action for the backend to know it's a post request
                    },
                    success: function(json) {
                        console.log("Item added to cart: ", json);
                        console.log("Cart Quantity: ", json.qty);
                        document.getElementById("cart-qty").textContent = json.qty;
                        // Show the notification
                        showNotification("Item added to cart!");
                    },
                    error: function(xhr, errmsg, err) {
                        console.log("Error in adding item to cart: ", errmsg);
                    }
                });
            } 
    });


      // Function to show notification
      function showNotification(message) {
        const notification = document.getElementById('notification-container');
        notification.textContent = message;  // Set the notification message

        // Show the notification
        notification.style.display = 'block';

        // Hide the notification after 3 seconds
        setTimeout(function() {
            notification.style.display = 'none';
        }, 3000);
    }
    
});
</script>


<style>
    body {
        background-image: none;
        background-color: #f4f7fc;
    }
    #notification-container {
    position: fixed;
    top: 10px;
    right: 10px;
    display: none;
    background-color: #4CAF50;
    color: white;
    padding: 10px;
    border-radius: 5px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    z-index: 9999;
    font-size: 16px;
}

    /* Sidebar styling */
    .sidebar {
        background-color: #f4f7fc;
        /* Light background */
        padding: 20px;
        border-right: 2px solid lightgray;
        height: 100vh;
        position: sticky;
        top: 0;
    }

    /* Title: "Menu of This Week" */
    .sidebar-title {
        font-size: 1.8rem;
        color: #007bff;
        /* Blue color */
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 2px;
        border-bottom: 2px solid #007bff;
        padding-bottom: 10px;
    }

    /* Styling for each button (day of the week) */
    .tabs {
        padding-left: 0;
        /* Ensures no default list styling */
        list-style: none;
        /* Ensures no bullets */
        margin: 0;
    }

    .tab-button {
        margin-bottom: 5px;
        /* Adds space between each menu item */
        background-color: #9facba;
        color: rgb(104, 38, 38);
        width: 100%;
        text-align: center;
        transition: background-color 0.3s, transform 0.2s;
        font-size: 1.2rem;
        font-weight: 500;
        cursor: pointer;
        /* Makes the button clickable */
        outline: none;
        /* Removes outline when clicked */
    }

    .tab-button:hover {
        background-color: hsl(22, 92%, 45%);
        transform: scale(1.05);
    }

    /* Active button (highlighted) */
    .tab-button.active {
        background-color: hsl(22, 92%, 45%);
        color: white;
        font-weight: bold;
        transform: scale(1.05);
    }

    .menu-content {
        padding: 20px;
    }

    .menu-items {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }

    .menu-item {
        flex: 1 1 calc(33% - 15px);
        margin: 10px;
    }

    .card {
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        height: 100%;
        transition: box-shadow 0.3s;
    }

    .card img {
        border-radius: 15px 15px 0 0;
        height: 150px;
        object-fit: cover;
    }

    .card-body {
        padding: 15px;
        text-align: center;
    }

    .card:hover {
        box-shadow: 0 8px 40px rgba(0, 0, 0, 0.2);
    }

    .add-to-cart {
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 10px 15px;
        cursor: pointer;
    }

    .add-to-cart:hover {
        background-color: #218838;
    }
    /* Styling for the menu items list */
    .menu-items {
    margin-top: 20px;
    }

/* Flexbox layout for each menu item button */
.item-button {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background-color: #f8f9fa; /* Light background for items */
    border: 1px solid #ddd; /* Light border */
    border-radius: 10px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    width: 100%;
    padding: 15px;
    margin-bottom: 10px;
}

.item-button:hover {
    background-color: #e9ecef; /* Background color change on hover */
}

/* Styling for item name and price (left side) */
.item-info {
    flex-grow: 1;
    text-align: left;
}

/* Item name style */
.item-name {
    font-size: 1.2em;
    color: darkslateblue;
    font-weight: bold;
}

/* Item price style */
.item-price {
    color: darkblue;
    font-size: 1.1em;
}

/* Styling for the item image */
.item-image img {
    border-radius: 50%; /* Make the image circular */
    height: 60px;
    width: 60px;
    object-fit: cover;
}

/* Add margin for each menu item */
.menu-item {
    margin-bottom: 15px;
}

/* Styling for the + sign overlay */
.add-to-cart-overlay {
    position: absolute;
    bottom: -10px;
    right: -1000px;
    background-color: rgba(14, 231, 25, 0.5); /* Semi-transparent background */
    border-radius: 30%;
   
    
}

.add-to-cart-text {
    color: rgb(20, 20, 20);
    font-size: 1.5em;
    font-weight: bold;
}
</style>

{% endblock %}