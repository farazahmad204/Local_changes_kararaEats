{% extends "base.html" %}


{% load static %}



{% block content %}

<main class="pt-5">
    
    <div class="container">
      
      <h1 class="h5"> Shopping cart </h1>

	    <hr>

      <!-- LP -->

    {% for menu in cart %}
    <div class="menu">
        <h3>{{ menu.menu_name }}</h3>  <!-- Display menu name -->
        <ul>
            {% for item in menu.items %}
                <li>
                      
                      <img src="{{item.item_img.url}}" alt="{{ item.item_name }}" class="img-thumbnail mr-3"
                      style="width: 50px; height: 50px; object-fit: cover; border-radius: 50%;">
                    <strong>{{ item.item_name }}</strong><br>
                    Quantity: {{ item.item_qty }}<br>
                    Price: ${{ item.item_price }}<br>
                    Total Price: ${{ item.total_price }}
                </li>

                <button type="button" data-index="{{product.id}}"
                    class="btn btn-primary btn-sm update-button">
                    Update
                  
                  </button>
                  
                  &nbsp;

                  <button type="button" data-index="{{product.id}}"
                    class="btn btn-danger btn-sm delete-button">
                    Delete
        
                  </button>
                  sub_total:: ${{ item.sub_total }}
            {% endfor %}
        </ul>
        
    </div>
{% endfor %}
    <!-- LP -->


      <div class="col-12 text-end">
 
        <div class="h6 fw-bold"> Total price: $ <div id="total" class="d-inline-flex"> {{cart.get_total}} </div></div>

        <br>

        <a href="/" class="btn btn-primary my-2"> <i class="fa fa-chevron-circle-right" aria-hidden="true"></i> &nbsp; Proceed to checkout </a>
        
      </div>

    </div>
  
    <br>

    <br>

 </main>

 <script>

  // Delete button

    $(document).on('click', '.delete-button', function(e){

      e.preventDefault();

      $.ajax({

          type: 'POST',
          url: '{% url "cart-delete" %}',
          data: {

              product_id: $(this).data('index'),
              csrfmiddlewaretoken: "{{csrf_token}}",
              action: 'post'

          },

          success: function(json){

              //console.log(json)

              location.reload();
              

              document.getElementById("cart-qty").textContent = json.qty

              document.getElementById("total").textContent = json.total


          },

          error: function(xhr, errmsg, err){


          }

      });


  })


  // Update button

  $(document).on('click', '.update-button', function(e){

    e.preventDefault();

    var theproductid = $(this).data('index');

    $.ajax({

        type: 'POST',
        url: '{% url "cart-update" %}',
        data: {

            product_id: $(this).data('index'),
            product_quantity: $('#select' + theproductid + ' option:selected').text(),
            csrfmiddlewaretoken: "{{csrf_token}}",
            action: 'post'

        },

        success: function(json){

            //console.log(json)

            location.reload();
            

            document.getElementById("cart-qty").textContent = json.qty

            document.getElementById("total").textContent = json.total


        },

        error: function(xhr, errmsg, err){


        }

    });


})



 </script>
 <style>

  body
  {
    background-image: none;
    background-color: rgb(117, 118, 119);
  }
 </style>


{% endblock %}

